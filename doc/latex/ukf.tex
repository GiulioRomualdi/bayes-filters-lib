The following snippet code shows how to run an Unscented Kalman Filter (KF) using the implementation provided by the library.~\newline



\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{ * Copyright (C) 2016-\/2019 Istituto Italiano di Tecnologia (IIT)}}
\DoxyCodeLine{3 \textcolor{comment}{ *}}
\DoxyCodeLine{4 \textcolor{comment}{ * This software may be modified and distributed under the terms of the}}
\DoxyCodeLine{5 \textcolor{comment}{ * BSD 3-\/Clause license. See the accompanying LICENSE file for details.}}
\DoxyCodeLine{6 \textcolor{comment}{ */}}
\DoxyCodeLine{7 }
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{Gaussian_8h}{BayesFilters/Gaussian.h}}>}}
\DoxyCodeLine{9 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{GaussianFilter_8h}{BayesFilters/GaussianFilter.h}}>}}
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{sigma__point_8h}{BayesFilters/sigma\_point.h}}>}}
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{SimulatedLinearSensor_8h}{BayesFilters/SimulatedLinearSensor.h}}>}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{SimulatedStateModel_8h}{BayesFilters/SimulatedStateModel.h}}>}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{UKFCorrection_8h}{BayesFilters/UKFCorrection.h}}>}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{UKFPrediction_8h}{BayesFilters/UKFPrediction.h}}>}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{utils_8h}{BayesFilters/utils.h}}>}}
\DoxyCodeLine{16 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{WhiteNoiseAcceleration_8h}{BayesFilters/WhiteNoiseAcceleration.h}}>}}
\DoxyCodeLine{17 }
\DoxyCodeLine{18 \textcolor{preprocessor}{\#include <string>}}
\DoxyCodeLine{19 }
\DoxyCodeLine{20 \textcolor{preprocessor}{\#include <Eigen/Dense>}}
\DoxyCodeLine{21 }
\DoxyCodeLine{22 \textcolor{keyword}{using namespace }\mbox{\hyperlink{namespacebfl}{bfl}};}
\DoxyCodeLine{23 \textcolor{keyword}{using namespace }Eigen;}
\DoxyCodeLine{24 }
\DoxyCodeLine{25 }
\DoxyCodeLine{26 \textcolor{keyword}{class }UKFSimulation : \textcolor{keyword}{public} \mbox{\hyperlink{classbfl_1_1GaussianFilter}{GaussianFilter}}}
\DoxyCodeLine{27 \{}
\DoxyCodeLine{28 \textcolor{keyword}{public}:}
\DoxyCodeLine{29     UKFSimulation}
\DoxyCodeLine{30     (}
\DoxyCodeLine{31         \mbox{\hyperlink{classbfl_1_1Gaussian}{Gaussian}}\& initial\_state,}
\DoxyCodeLine{32         std::unique\_ptr<GaussianPrediction> prediction,}
\DoxyCodeLine{33         std::unique\_ptr<GaussianCorrection> correction,}
\DoxyCodeLine{34         std::size\_t simulation\_steps}
\DoxyCodeLine{35     ) noexcept :}
\DoxyCodeLine{36         \mbox{\hyperlink{classbfl_1_1GaussianFilter}{GaussianFilter}}(std::move(prediction), std::move(correction)),}
\DoxyCodeLine{37         predicted\_state\_(initial\_state.dim\_linear, initial\_state.dim\_circular),}
\DoxyCodeLine{38         corrected\_state\_(initial\_state),}
\DoxyCodeLine{39         simulation\_steps\_(simulation\_steps)}
\DoxyCodeLine{40     \{ \}}
\DoxyCodeLine{41 }
\DoxyCodeLine{42 \textcolor{keyword}{protected}:}
\DoxyCodeLine{43     \textcolor{keywordtype}{bool} run\_condition()\textcolor{keyword}{ override}}
\DoxyCodeLine{44 \textcolor{keyword}{    }\{}
\DoxyCodeLine{45         \textcolor{keywordflow}{if} (step\_number() < simulation\_steps\_)}
\DoxyCodeLine{46             \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{47         \textcolor{keywordflow}{else}}
\DoxyCodeLine{48             \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{49     \}}
\DoxyCodeLine{50 }
\DoxyCodeLine{51 }
\DoxyCodeLine{52     \textcolor{keywordtype}{bool} initialization\_step()\textcolor{keyword}{ override}}
\DoxyCodeLine{53 \textcolor{keyword}{    }\{}
\DoxyCodeLine{54         \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{55     \}}
\DoxyCodeLine{56 }
\DoxyCodeLine{57 }
\DoxyCodeLine{58     \textcolor{keywordtype}{void} filtering\_step()\textcolor{keyword}{ override}}
\DoxyCodeLine{59 \textcolor{keyword}{    }\{}
\DoxyCodeLine{60         prediction().predict(corrected\_state\_, predicted\_state\_);}
\DoxyCodeLine{61         correction().freeze\_measurements();}
\DoxyCodeLine{62         correction().correct(predicted\_state\_, corrected\_state\_);}
\DoxyCodeLine{63 }
\DoxyCodeLine{64         log();}
\DoxyCodeLine{65     \}}
\DoxyCodeLine{66 }
\DoxyCodeLine{67 }
\DoxyCodeLine{68     std::vector<std::string> log\_file\_names(\textcolor{keyword}{const} std::string\& folder\_path, \textcolor{keyword}{const} std::string\& file\_name\_prefix)\textcolor{keyword}{ override}}
\DoxyCodeLine{69 \textcolor{keyword}{    }\{}
\DoxyCodeLine{70         \textcolor{keywordflow}{return} \{folder\_path + \textcolor{stringliteral}{"/"} + file\_name\_prefix + \textcolor{stringliteral}{"\_pred\_mean"},}
\DoxyCodeLine{71                 folder\_path + \textcolor{stringliteral}{"/"} + file\_name\_prefix + \textcolor{stringliteral}{"\_cor\_mean"}\};}
\DoxyCodeLine{72     \}}
\DoxyCodeLine{73 }
\DoxyCodeLine{74 }
\DoxyCodeLine{75     \textcolor{keywordtype}{void} log()\textcolor{keyword}{ override}}
\DoxyCodeLine{76 \textcolor{keyword}{    }\{}
\DoxyCodeLine{77         logger(predicted\_state\_.mean().transpose(), corrected\_state\_.mean().transpose());}
\DoxyCodeLine{78     \}}
\DoxyCodeLine{79 }
\DoxyCodeLine{80 \textcolor{keyword}{private}:}
\DoxyCodeLine{81     \mbox{\hyperlink{classbfl_1_1Gaussian}{Gaussian}} predicted\_state\_;}
\DoxyCodeLine{82 }
\DoxyCodeLine{83     \mbox{\hyperlink{classbfl_1_1Gaussian}{Gaussian}} corrected\_state\_;}
\DoxyCodeLine{84 }
\DoxyCodeLine{85     std::size\_t simulation\_steps\_;}
\DoxyCodeLine{86 \};}
\DoxyCodeLine{87 }
\DoxyCodeLine{88 }
\DoxyCodeLine{89 \textcolor{keywordtype}{int} main(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char}* argv[])}
\DoxyCodeLine{90 \{}
\DoxyCodeLine{91     std::cout << \textcolor{stringliteral}{"Running a UKF filter on a simulated target."} << std::endl;}
\DoxyCodeLine{92 }
\DoxyCodeLine{93     \textcolor{keyword}{const} \textcolor{keywordtype}{bool} write\_to\_file = (argc > 1 ? std::string(argv[1]) == \textcolor{stringliteral}{"ON"} : \textcolor{keyword}{false});}
\DoxyCodeLine{94     \textcolor{keywordflow}{if} (write\_to\_file)}
\DoxyCodeLine{95         std::cout << \textcolor{stringliteral}{"Data is logged in the test folder with prefix testUKF."} << std::endl;}
\DoxyCodeLine{96 }
\DoxyCodeLine{97 }
\DoxyCodeLine{98     \textcolor{comment}{/* A set of parameters needed to run an unscented Kalman filter in a simulated environment. */}}
\DoxyCodeLine{99     Vector4d initial\_simulated\_state(10.0f, 0.0f, 10.0f, 0.0f);}
\DoxyCodeLine{100     std::size\_t simulation\_time = 100;}
\DoxyCodeLine{101     \textcolor{comment}{/* Initialize unscented transform parameters. */}}
\DoxyCodeLine{102     \textcolor{keywordtype}{double} alpha = 1.0;}
\DoxyCodeLine{103     \textcolor{keywordtype}{double} beta = 2.0;}
\DoxyCodeLine{104     \textcolor{keywordtype}{double} kappa = 0.0;}
\DoxyCodeLine{105 }
\DoxyCodeLine{106 }
\DoxyCodeLine{107     \textcolor{comment}{/* Step 1 -\/ Initialization */}}
\DoxyCodeLine{108 }
\DoxyCodeLine{109     std::size\_t state\_size = 4;}
\DoxyCodeLine{110     \mbox{\hyperlink{classbfl_1_1Gaussian}{Gaussian}} initial\_state(state\_size);}
\DoxyCodeLine{111     Vector4d initial\_mean(4.0f, 0.04f, 15.0f, 0.4f);}
\DoxyCodeLine{112     Matrix4d initial\_covariance;}
\DoxyCodeLine{113     initial\_covariance << pow(0.05, 2), 0,            0,            0,}
\DoxyCodeLine{114                           0,            pow(0.05, 2), 0,            0,}
\DoxyCodeLine{115                           0,            0,            pow(0.01, 2), 0,}
\DoxyCodeLine{116                           0,            0,            0,            pow(0.01, 2);}
\DoxyCodeLine{117     initial\_state.mean() = initial\_mean;}
\DoxyCodeLine{118     initial\_state.covariance() = initial\_covariance;}
\DoxyCodeLine{119 }
\DoxyCodeLine{120 }
\DoxyCodeLine{121     \textcolor{comment}{/* Step 2 -\/ Prediction */}}
\DoxyCodeLine{122 }
\DoxyCodeLine{123     \textcolor{comment}{/* Step 2.1 -\/ Define the state model. */}}
\DoxyCodeLine{124 }
\DoxyCodeLine{125     \textcolor{comment}{/* Initialize a white noise acceleration state model. */}}
\DoxyCodeLine{126     \textcolor{keywordtype}{double} T = 1.0f;}
\DoxyCodeLine{127     \textcolor{keywordtype}{double} tilde\_q = 10.0f;}
\DoxyCodeLine{128 }
\DoxyCodeLine{129     std::unique\_ptr<AdditiveStateModel> wna = utils::make\_unique<WhiteNoiseAcceleration>(\mbox{\hyperlink{classbfl_1_1WhiteNoiseAcceleration_ad38237bda14ccceba94d06ac1155f3cea7fec533aaab2dc4c675964c8ff8a747b}{WhiteNoiseAcceleration::Dim::TwoD}}, T, tilde\_q);}
\DoxyCodeLine{130 }
\DoxyCodeLine{131     \textcolor{comment}{/* Step 2.2 -\/ Define the prediction step. */}}
\DoxyCodeLine{132 }
\DoxyCodeLine{133     \textcolor{comment}{/* Initialize the unscented Kalman filter prediction step and pass the ownership of the state model */}}
\DoxyCodeLine{134     std::unique\_ptr<UKFPrediction> ukf\_prediction = utils::make\_unique<UKFPrediction>(std::move(wna), alpha, beta, kappa);}
\DoxyCodeLine{135 }
\DoxyCodeLine{136 }
\DoxyCodeLine{137     \textcolor{comment}{/* Step 3 -\/ Correction */}}
\DoxyCodeLine{138 }
\DoxyCodeLine{139     \textcolor{comment}{/* Step 3.1 -\/ Define where the measurement are originated from (simulated in this case). */}}
\DoxyCodeLine{140 }
\DoxyCodeLine{141     \textcolor{comment}{/* Initialize simulated target model with a white noise acceleration. */}}
\DoxyCodeLine{142     std::unique\_ptr<AdditiveStateModel> target\_model = utils::make\_unique<WhiteNoiseAcceleration>(\mbox{\hyperlink{classbfl_1_1WhiteNoiseAcceleration_ad38237bda14ccceba94d06ac1155f3cea7fec533aaab2dc4c675964c8ff8a747b}{WhiteNoiseAcceleration::Dim::TwoD}}, T, tilde\_q);}
\DoxyCodeLine{143     std::unique\_ptr<SimulatedStateModel> simulated\_state\_model = utils::make\_unique<SimulatedStateModel>(std::move(target\_model), initial\_simulated\_state, simulation\_time);}
\DoxyCodeLine{144 }
\DoxyCodeLine{145     \textcolor{keywordflow}{if} (write\_to\_file)}
\DoxyCodeLine{146         simulated\_state\_model-\/>enable\_log(\textcolor{stringliteral}{"./"}, \textcolor{stringliteral}{"testUKF"});}
\DoxyCodeLine{147 }
\DoxyCodeLine{148     \textcolor{comment}{/* Step 3.2 -\/ Initialize a measurement model (a linear sensor reading x and y coordinates). */}}
\DoxyCodeLine{149     \textcolor{keywordtype}{double} sigma\_x = 10.0;}
\DoxyCodeLine{150     \textcolor{keywordtype}{double} sigma\_y = 10.0;}
\DoxyCodeLine{151     Eigen::MatrixXd R(2, 2);}
\DoxyCodeLine{152     R << std::pow(sigma\_x, 2.0),                    0.0,}
\DoxyCodeLine{153                             0.0, std::pow(sigma\_y, 2.0);}
\DoxyCodeLine{154 }
\DoxyCodeLine{155     std::unique\_ptr<AdditiveMeasurementModel> simulated\_linear\_sensor = utils::make\_unique<SimulatedLinearSensor>(std::move(simulated\_state\_model), \mbox{\hyperlink{classbfl_1_1LinearModel_a35a55d925652256ca6865a4b324315ee}{SimulatedLinearSensor::LinearMatrixComponent}}\{ 4, std::vector<std::size\_t>\{ 0, 2 \} \}, R);}
\DoxyCodeLine{156 }
\DoxyCodeLine{157     \textcolor{keywordflow}{if} (write\_to\_file)}
\DoxyCodeLine{158         simulated\_linear\_sensor-\/>enable\_log(\textcolor{stringliteral}{"./"}, \textcolor{stringliteral}{"testUKF"});}
\DoxyCodeLine{159 }
\DoxyCodeLine{160     \textcolor{comment}{/* Step 3.3 -\/ Initialize the unscented Kalman filter correction step and pass the ownership of the measurement model. */}}
\DoxyCodeLine{161     std::unique\_ptr<UKFCorrection> ukf\_correction = utils::make\_unique<UKFCorrection>(std::move(simulated\_linear\_sensor), alpha, beta, kappa);}
\DoxyCodeLine{162 }
\DoxyCodeLine{163 }
\DoxyCodeLine{164     \textcolor{comment}{/* Step 4 -\/ Assemble the unscented Kalman filter. */}}
\DoxyCodeLine{165     std::cout << \textcolor{stringliteral}{"Constructing unscented Kalman filter..."} << std::flush;}
\DoxyCodeLine{166 }
\DoxyCodeLine{167     UKFSimulation ukf(initial\_state, std::move(ukf\_prediction), std::move(ukf\_correction), simulation\_time);}
\DoxyCodeLine{168 }
\DoxyCodeLine{169     \textcolor{keywordflow}{if} (write\_to\_file)}
\DoxyCodeLine{170         ukf.enable\_log(\textcolor{stringliteral}{"./"}, \textcolor{stringliteral}{"testUKF"});}
\DoxyCodeLine{171 }
\DoxyCodeLine{172     std::cout << \textcolor{stringliteral}{"done!"} << std::endl;}
\DoxyCodeLine{173 }
\DoxyCodeLine{174 }
\DoxyCodeLine{175     \textcolor{comment}{/* Step 5 -\/ Boot the filter. */}}
\DoxyCodeLine{176     std::cout << \textcolor{stringliteral}{"Booting unscented Kalman filter..."} << std::flush;}
\DoxyCodeLine{177 }
\DoxyCodeLine{178     ukf.boot();}
\DoxyCodeLine{179 }
\DoxyCodeLine{180     std::cout << \textcolor{stringliteral}{"completed!"} << std::endl;}
\DoxyCodeLine{181 }
\DoxyCodeLine{182 }
\DoxyCodeLine{183     \textcolor{comment}{/* Step 6 -\/ Run the filter and wait until it is closed. */}}
\DoxyCodeLine{184     \textcolor{comment}{/* Note that since this is a simulation, the filter will end upon simulation termination. */}}
\DoxyCodeLine{185     std::cout << \textcolor{stringliteral}{"Running unscented Kalman filter..."} << std::flush;}
\DoxyCodeLine{186 }
\DoxyCodeLine{187     ukf.run();}
\DoxyCodeLine{188 }
\DoxyCodeLine{189     std::cout << \textcolor{stringliteral}{"waiting..."} << std::flush;}
\DoxyCodeLine{190 }
\DoxyCodeLine{191     \textcolor{keywordflow}{if} (!ukf.wait())}
\DoxyCodeLine{192         \textcolor{keywordflow}{return} EXIT\_FAILURE;}
\DoxyCodeLine{193 }
\DoxyCodeLine{194     std::cout << \textcolor{stringliteral}{"completed!"} << std::endl;}
\DoxyCodeLine{195 }
\DoxyCodeLine{196     \textcolor{keywordflow}{return} EXIT\_SUCCESS;}
\DoxyCodeLine{197 \}}
\end{DoxyCodeInclude}
 