The following snippet code shows how to run a Kalman Filter (KF) using the implementation provided by the library.~\newline



\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{ * Copyright (C) 2016-\/2019 Istituto Italiano di Tecnologia (IIT)}}
\DoxyCodeLine{3 \textcolor{comment}{ *}}
\DoxyCodeLine{4 \textcolor{comment}{ * This software may be modified and distributed under the terms of the}}
\DoxyCodeLine{5 \textcolor{comment}{ * BSD 3-\/Clause license. See the accompanying LICENSE file for details.}}
\DoxyCodeLine{6 \textcolor{comment}{ */}}
\DoxyCodeLine{7 }
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{Gaussian_8h}{BayesFilters/Gaussian.h}}>}}
\DoxyCodeLine{9 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{GaussianFilter_8h}{BayesFilters/GaussianFilter.h}}>}}
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{KFCorrection_8h}{BayesFilters/KFCorrection.h}}>}}
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{KFPrediction_8h}{BayesFilters/KFPrediction.h}}>}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{SimulatedLinearSensor_8h}{BayesFilters/SimulatedLinearSensor.h}}>}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{SimulatedStateModel_8h}{BayesFilters/SimulatedStateModel.h}}>}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{WhiteNoiseAcceleration_8h}{BayesFilters/WhiteNoiseAcceleration.h}}>}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{utils_8h}{BayesFilters/utils.h}}>}}
\DoxyCodeLine{16 }
\DoxyCodeLine{17 \textcolor{preprocessor}{\#include <string>}}
\DoxyCodeLine{18 }
\DoxyCodeLine{19 \textcolor{preprocessor}{\#include <Eigen/Dense>}}
\DoxyCodeLine{20 }
\DoxyCodeLine{21 \textcolor{keyword}{using namespace }\mbox{\hyperlink{namespacebfl}{bfl}};}
\DoxyCodeLine{22 \textcolor{keyword}{using namespace }Eigen;}
\DoxyCodeLine{23 }
\DoxyCodeLine{24 }
\DoxyCodeLine{25 \textcolor{keyword}{class }KFSimulation : \textcolor{keyword}{public} \mbox{\hyperlink{classbfl_1_1GaussianFilter}{GaussianFilter}}}
\DoxyCodeLine{26 \{}
\DoxyCodeLine{27 \textcolor{keyword}{public}:}
\DoxyCodeLine{28     KFSimulation}
\DoxyCodeLine{29     (}
\DoxyCodeLine{30         \mbox{\hyperlink{classbfl_1_1Gaussian}{Gaussian}}\& initial\_state,}
\DoxyCodeLine{31         std::unique\_ptr<GaussianPrediction> prediction,}
\DoxyCodeLine{32         std::unique\_ptr<GaussianCorrection> correction,}
\DoxyCodeLine{33         std::size\_t simulation\_steps}
\DoxyCodeLine{34     ) noexcept :}
\DoxyCodeLine{35         \mbox{\hyperlink{classbfl_1_1GaussianFilter}{GaussianFilter}}(std::move(prediction), std::move(correction)),}
\DoxyCodeLine{36         predicted\_state\_(initial\_state.dim\_linear, initial\_state.dim\_circular),}
\DoxyCodeLine{37         corrected\_state\_(initial\_state),}
\DoxyCodeLine{38         simulation\_steps\_(simulation\_steps)}
\DoxyCodeLine{39     \{ \}}
\DoxyCodeLine{40 }
\DoxyCodeLine{41 \textcolor{keyword}{protected}:}
\DoxyCodeLine{42     \textcolor{keywordtype}{bool} run\_condition()\textcolor{keyword}{ override}}
\DoxyCodeLine{43 \textcolor{keyword}{    }\{}
\DoxyCodeLine{44         \textcolor{keywordflow}{if} (step\_number() < simulation\_steps\_)}
\DoxyCodeLine{45             \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{46         \textcolor{keywordflow}{else}}
\DoxyCodeLine{47             \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{48     \}}
\DoxyCodeLine{49 }
\DoxyCodeLine{50 }
\DoxyCodeLine{51     \textcolor{keywordtype}{bool} initialization\_step()\textcolor{keyword}{ override}}
\DoxyCodeLine{52 \textcolor{keyword}{    }\{}
\DoxyCodeLine{53         \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{54     \}}
\DoxyCodeLine{55 }
\DoxyCodeLine{56 }
\DoxyCodeLine{57     \textcolor{keywordtype}{void} filtering\_step()\textcolor{keyword}{ override}}
\DoxyCodeLine{58 \textcolor{keyword}{    }\{}
\DoxyCodeLine{59         prediction().predict(corrected\_state\_, predicted\_state\_);}
\DoxyCodeLine{60         correction().freeze\_measurements();}
\DoxyCodeLine{61         correction().correct(predicted\_state\_, corrected\_state\_);}
\DoxyCodeLine{62 }
\DoxyCodeLine{63         log();}
\DoxyCodeLine{64     \}}
\DoxyCodeLine{65 }
\DoxyCodeLine{66 }
\DoxyCodeLine{67     std::vector<std::string> log\_file\_names(\textcolor{keyword}{const} std::string\& folder\_path, \textcolor{keyword}{const} std::string\& file\_name\_prefix)\textcolor{keyword}{ override}}
\DoxyCodeLine{68 \textcolor{keyword}{    }\{}
\DoxyCodeLine{69         \textcolor{keywordflow}{return}  \{folder\_path + \textcolor{stringliteral}{"/"} + file\_name\_prefix + \textcolor{stringliteral}{"\_pred\_mean"},}
\DoxyCodeLine{70                  folder\_path + \textcolor{stringliteral}{"/"} + file\_name\_prefix + \textcolor{stringliteral}{"\_cor\_mean"}\};}
\DoxyCodeLine{71     \}}
\DoxyCodeLine{72 }
\DoxyCodeLine{73 }
\DoxyCodeLine{74     \textcolor{keywordtype}{void} log()\textcolor{keyword}{ override}}
\DoxyCodeLine{75 \textcolor{keyword}{    }\{}
\DoxyCodeLine{76         logger(predicted\_state\_.mean().transpose(), corrected\_state\_.mean().transpose());}
\DoxyCodeLine{77     \}}
\DoxyCodeLine{78 }
\DoxyCodeLine{79 \textcolor{keyword}{private}:}
\DoxyCodeLine{80     \mbox{\hyperlink{classbfl_1_1Gaussian}{Gaussian}} predicted\_state\_;}
\DoxyCodeLine{81 }
\DoxyCodeLine{82     \mbox{\hyperlink{classbfl_1_1Gaussian}{Gaussian}} corrected\_state\_;}
\DoxyCodeLine{83 }
\DoxyCodeLine{84     std::size\_t simulation\_steps\_;}
\DoxyCodeLine{85 \};}
\DoxyCodeLine{86 }
\DoxyCodeLine{87 }
\DoxyCodeLine{88 \textcolor{keywordtype}{int} main(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char}* argv[])}
\DoxyCodeLine{89 \{}
\DoxyCodeLine{90     std::cout << \textcolor{stringliteral}{"Running a KF filter on a simulated target."} << std::endl;}
\DoxyCodeLine{91 }
\DoxyCodeLine{92     \textcolor{keyword}{const} \textcolor{keywordtype}{bool} write\_to\_file = (argc > 1 ? std::string(argv[1]) == \textcolor{stringliteral}{"ON"} : \textcolor{keyword}{false});}
\DoxyCodeLine{93     \textcolor{keywordflow}{if} (write\_to\_file)}
\DoxyCodeLine{94         std::cout << \textcolor{stringliteral}{"Data is logged in the test folder with prefix testKF."} << std::endl;}
\DoxyCodeLine{95 }
\DoxyCodeLine{96 }
\DoxyCodeLine{97     \textcolor{comment}{/* A set of parameters needed to run a Kalman filter in a simulated environment. */}}
\DoxyCodeLine{98     Vector4d initial\_simulated\_state(10.0f, 0.0f, 10.0f, 0.0f);}
\DoxyCodeLine{99     std::size\_t simulation\_time = 100;}
\DoxyCodeLine{100 }
\DoxyCodeLine{101 }
\DoxyCodeLine{102     \textcolor{comment}{/* Step 1 -\/ Initialization */}}
\DoxyCodeLine{103 }
\DoxyCodeLine{104     \mbox{\hyperlink{classbfl_1_1Gaussian}{Gaussian}} initial\_state(4);}
\DoxyCodeLine{105     Vector4d initial\_mean(4.0f, 0.04f, 15.0f, 0.4f);}
\DoxyCodeLine{106     Matrix4d initial\_covariance;}
\DoxyCodeLine{107     initial\_covariance << pow(0.05, 2), 0,            0,            0,}
\DoxyCodeLine{108                           0,            pow(0.05, 2), 0,            0,}
\DoxyCodeLine{109                           0,            0,            pow(0.01, 2), 0,}
\DoxyCodeLine{110                           0,            0,            0,            pow(0.01, 2);}
\DoxyCodeLine{111     initial\_state.mean() = initial\_mean;}
\DoxyCodeLine{112     initial\_state.covariance() = initial\_covariance;}
\DoxyCodeLine{113 }
\DoxyCodeLine{114 }
\DoxyCodeLine{115     \textcolor{comment}{/* Step 2 -\/ Prediction */}}
\DoxyCodeLine{116 }
\DoxyCodeLine{117     \textcolor{comment}{/* Step 2.1 -\/ Define the state model. */}}
\DoxyCodeLine{118 }
\DoxyCodeLine{119     \textcolor{comment}{/* Initialize a white noise acceleration state model. */}}
\DoxyCodeLine{120     \textcolor{keywordtype}{double} T = 1.0f;}
\DoxyCodeLine{121     \textcolor{keywordtype}{double} tilde\_q = 10.0f;}
\DoxyCodeLine{122 }
\DoxyCodeLine{123     std::unique\_ptr<LinearStateModel> wna = utils::make\_unique<WhiteNoiseAcceleration>(\mbox{\hyperlink{classbfl_1_1WhiteNoiseAcceleration_ad38237bda14ccceba94d06ac1155f3cea7fec533aaab2dc4c675964c8ff8a747b}{WhiteNoiseAcceleration::Dim::TwoD}}, T, tilde\_q);}
\DoxyCodeLine{124 }
\DoxyCodeLine{125     \textcolor{comment}{/* Step 2.2 -\/ Define the prediction step. */}}
\DoxyCodeLine{126 }
\DoxyCodeLine{127     \textcolor{comment}{/* Initialize the Kalman filter prediction step and pass the ownership of the state model. */}}
\DoxyCodeLine{128     std::unique\_ptr<KFPrediction> kf\_prediction = utils::make\_unique<KFPrediction>(std::move(wna));}
\DoxyCodeLine{129 }
\DoxyCodeLine{130 }
\DoxyCodeLine{131     \textcolor{comment}{/* Step 3 -\/ Correction */}}
\DoxyCodeLine{132 }
\DoxyCodeLine{133     \textcolor{comment}{/* Step 3.1 -\/ Define where the measurement are originated from (simulated in this case). */}}
\DoxyCodeLine{134 }
\DoxyCodeLine{135     \textcolor{comment}{/* Initialize simulated target model with a white noise acceleration. */}}
\DoxyCodeLine{136     std::unique\_ptr<StateModel> target\_model = utils::make\_unique<WhiteNoiseAcceleration>(\mbox{\hyperlink{classbfl_1_1WhiteNoiseAcceleration_ad38237bda14ccceba94d06ac1155f3cea7fec533aaab2dc4c675964c8ff8a747b}{WhiteNoiseAcceleration::Dim::TwoD}}, T, tilde\_q);}
\DoxyCodeLine{137     std::unique\_ptr<SimulatedStateModel> simulated\_state\_model = utils::make\_unique<SimulatedStateModel>(std::move(target\_model), initial\_simulated\_state, simulation\_time);}
\DoxyCodeLine{138 }
\DoxyCodeLine{139     \textcolor{keywordflow}{if} (write\_to\_file)}
\DoxyCodeLine{140         simulated\_state\_model-\/>enable\_log(\textcolor{stringliteral}{"./"}, \textcolor{stringliteral}{"testKF"});}
\DoxyCodeLine{141 }
\DoxyCodeLine{142     \textcolor{comment}{/* Step 3.2 -\/ Initialize a measurement model (a linear sensor reading x and y coordinates). */}}
\DoxyCodeLine{143     \textcolor{keywordtype}{double} sigma\_x = 10.0;}
\DoxyCodeLine{144     \textcolor{keywordtype}{double} sigma\_y = 10.0;}
\DoxyCodeLine{145     Eigen::MatrixXd R(2, 2);}
\DoxyCodeLine{146     R << std::pow(sigma\_x, 2.0),                    0.0,}
\DoxyCodeLine{147                             0.0, std::pow(sigma\_y, 2.0);}
\DoxyCodeLine{148 }
\DoxyCodeLine{149     std::unique\_ptr<LinearMeasurementModel> simulated\_linear\_sensor = utils::make\_unique<SimulatedLinearSensor>(std::move(simulated\_state\_model), \mbox{\hyperlink{classbfl_1_1LinearModel_a35a55d925652256ca6865a4b324315ee}{SimulatedLinearSensor::LinearMatrixComponent}}\{ 4, std::vector<std::size\_t>\{ 0, 2 \} \}, R);}
\DoxyCodeLine{150 }
\DoxyCodeLine{151     \textcolor{keywordflow}{if} (write\_to\_file)}
\DoxyCodeLine{152         simulated\_linear\_sensor-\/>enable\_log(\textcolor{stringliteral}{"./"}, \textcolor{stringliteral}{"testKF"});}
\DoxyCodeLine{153 }
\DoxyCodeLine{154     \textcolor{comment}{/* Step 3.3 -\/ Initialize the Kalman filter correction step and pass the ownership of the measurement model. */}}
\DoxyCodeLine{155     std::unique\_ptr<KFCorrection> kf\_correction = utils::make\_unique<KFCorrection>(std::move(simulated\_linear\_sensor));}
\DoxyCodeLine{156 }
\DoxyCodeLine{157 }
\DoxyCodeLine{158     \textcolor{comment}{/* Step 4 -\/ Assemble the Kalman filter. */}}
\DoxyCodeLine{159     std::cout << \textcolor{stringliteral}{"Constructing Kalman filter..."} << std::flush;}
\DoxyCodeLine{160 }
\DoxyCodeLine{161     KFSimulation kf(initial\_state, std::move(kf\_prediction), std::move(kf\_correction), simulation\_time);}
\DoxyCodeLine{162 }
\DoxyCodeLine{163     \textcolor{keywordflow}{if} (write\_to\_file)}
\DoxyCodeLine{164         kf.enable\_log(\textcolor{stringliteral}{"./"}, \textcolor{stringliteral}{"testKF"});}
\DoxyCodeLine{165 }
\DoxyCodeLine{166     std::cout << \textcolor{stringliteral}{"done!"} << std::endl;}
\DoxyCodeLine{167 }
\DoxyCodeLine{168 }
\DoxyCodeLine{169     \textcolor{comment}{/* Step 5 -\/ Boot the filter. */}}
\DoxyCodeLine{170     std::cout << \textcolor{stringliteral}{"Booting Kalman filter..."} << std::flush;}
\DoxyCodeLine{171 }
\DoxyCodeLine{172     kf.boot();}
\DoxyCodeLine{173 }
\DoxyCodeLine{174     std::cout << \textcolor{stringliteral}{"completed!"} << std::endl;}
\DoxyCodeLine{175 }
\DoxyCodeLine{176 }
\DoxyCodeLine{177     \textcolor{comment}{/* Step 6 -\/ Run the filter and wait until it is closed. */}}
\DoxyCodeLine{178     \textcolor{comment}{/* Note that since this is a simulation, the filter will end upon simulation termination. */}}
\DoxyCodeLine{179     std::cout << \textcolor{stringliteral}{"Running Kalman filter..."} << std::flush;}
\DoxyCodeLine{180 }
\DoxyCodeLine{181     kf.run();}
\DoxyCodeLine{182 }
\DoxyCodeLine{183     std::cout << \textcolor{stringliteral}{"waiting..."} << std::flush;}
\DoxyCodeLine{184 }
\DoxyCodeLine{185     \textcolor{keywordflow}{if} (!kf.wait())}
\DoxyCodeLine{186         \textcolor{keywordflow}{return} EXIT\_FAILURE;}
\DoxyCodeLine{187 }
\DoxyCodeLine{188     std::cout << \textcolor{stringliteral}{"completed!"} << std::endl;}
\DoxyCodeLine{189 }
\DoxyCodeLine{190     \textcolor{keywordflow}{return} EXIT\_SUCCESS;}
\DoxyCodeLine{191 \}}
\end{DoxyCodeInclude}
 